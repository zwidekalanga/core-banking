name: core-banking

services:
  banking-inbound-http:
    build:
      context: .
      target: development
    container_name: banking-inbound-http
    restart: on-failure
    ports:
      - "8001:8001"
    environment:
      - ENVIRONMENT=development
      - API_PORT=8001
      - DATABASE_URL=postgresql+asyncpg://postgres:postgres@postgres:5432/core_banking
      - REDIS_URL=redis://redis:6379/1
      - KAFKA_BOOTSTRAP_SERVERS=kafka:29092
      - FRAUD_GRPC_TARGET=fraud-inbound-grpc:50051
      - CELERY_BROKER_URL=amqp://guest:guest@rabbitmq:5672//
      - CELERY_RESULT_BACKEND=redis://redis:6379/3
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:-CHANGE-ME-IN-PRODUCTION}
      - LOG_LEVEL=DEBUG
    volumes:
      - ./app:/app/app
      - ./alembic:/app/alembic
      - ./scripts:/app/scripts
      - ./tests:/app/tests
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    networks:
      - sentinel-network

networks:
  sentinel-network:
    name: sentinel-network
    driver: bridge
